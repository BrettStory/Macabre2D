<metro:MetroWindow x:Class="Macabre2D.UI.Library.Views.Dialogs.SelectSpriteDialog"
                   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                   xmlns:controls="clr-namespace:Macabre2D.UI.Library.Controls"
                   xmlns:metro="http://metro.mahapps.com/winfx/xaml/controls"
                   Style="{StaticResource StandardWindowStyle}"
                   Title="Select Sprite"
                   WindowStartupLocation="CenterScreen"
                   Height="600"
                   Width="800">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <controls:CollectionFilterBox Grid.Row="0"
                                      x:Name="_filterBox"
                                      ItemsSource="{Binding SpriteWrappers, Mode=OneWay}"
                                      FilterFunc="{Binding FilterFunc, Mode=OneTime}" />

        <ListBox x:Name="_indexedSpritesListBox"
                 Grid.Row="1"
                 SelectionMode="Single"
                 ItemsSource="{Binding FilteredItems, ElementName=_filterBox, Mode=OneWay}"
                 SelectedItem="{Binding SelectedSprite}"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>

            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Grid Width="128"
                          Height="128">
                        <controls:SpriteViewer Margin="0"
                                               Size="128"
                                               ShowSpriteInfo="True"
                                               Sprite="{Binding}" />
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>

            <ListBox.ItemContainerStyle>
                <Style TargetType="{x:Type ListBoxItem}" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                    <Setter Property="Margin" Value="{StaticResource StandardMarginAll}" />
                    <Setter Property="Padding" Value="0" />
                    <Setter Property="BorderThickness" Value="4" />

                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="BorderBrush" Value="{StaticResource BlackBrush}" />
                        </Trigger>
                        <Trigger Property="IsSelected" Value="False">
                            <Setter Property="BorderBrush" Value="{StaticResource AccentColorBrush}" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </ListBox.ItemContainerStyle>
        </ListBox>

        <Grid HorizontalAlignment="Stretch"
              Grid.Row="2"
              Margin="{StaticResource StandardMarginAll}">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       VerticalAlignment="Center"
                       Text="{Binding SelectedSprite.Name}" />

            <Button Grid.Column="1"
                    Content="_OK"
                    Command="{Binding OKCommand}"
                    IsDefault="True"
                    Width="65" />

            <Button Grid.Column="2"
                    Content="_Cancel"
                    Command="{Binding CancelCommand}"
                    HorizontalAlignment="Right"
                    IsCancel="True"
                    Width="65" />
        </Grid>
    </Grid>
</metro:MetroWindow>